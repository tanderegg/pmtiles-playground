{"version":3,"file":"generate-glsl.js","names":["capitalize","generateGLSLForModule","module","options","generateGLSLUniformDeclarations","glsl","uniforms","push","name","uniformName","uniformFormat","Object","entries","uniformTypes","glslUniformType","getGLSLUniformType","join","UNIFORM_TYPE_TO_GLSL"],"sources":["../../../../src/lib/shader-generator/glsl/generate-glsl.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport {UniformFormat} from '../../../types';\nimport {ShaderModule} from '../../../lib/shader-module/shader-module';\nimport {capitalize} from '../utils/capitalize';\n\nexport type GLSLGenerationOptions = {\n  shaderLanguage: 'glsl';\n  uniforms: 'scoped-interface-blocks' | 'unscoped-interface-blocks' | 'uniforms';\n};\n\nexport function generateGLSLForModule(module: ShaderModule, options: GLSLGenerationOptions) {\n  return generateGLSLUniformDeclarations(module, options);\n}\n\nfunction generateGLSLUniformDeclarations(module: ShaderModule, options: GLSLGenerationOptions): string {\n  const glsl: string[] = [];\n\n  // => uniform UniformBlockName {\n  switch (options.uniforms) {\n    case 'scoped-interface-blocks':\n    case 'unscoped-interface-blocks':\n      glsl.push(`uniform ${capitalize(module.name)} {`);\n      break;\n    case 'uniforms':\n      // ignore\n  }\n\n  for (const [uniformName, uniformFormat] of Object.entries(module.uniformTypes || {})) {\n    const glslUniformType = getGLSLUniformType(uniformFormat);\n    switch (options.uniforms) {\n      case 'scoped-interface-blocks':\n      // => uniform UniformBlockName {\n        glsl.push(`  ${glslUniformType} ${uniformName};`);\n        break;\n      case 'unscoped-interface-blocks':\n      // => uniform UniformBlockName {\n        glsl.push(`  ${glslUniformType} ${module.name}_${uniformName};`);\n        break;\n      case 'uniforms':\n        glsl.push(`uniform ${glslUniformType} ${module.name}_${uniformName};`);\n    }\n  }\n\n  switch (options.uniforms) {\n    case 'scoped-interface-blocks':\n      glsl.push(`} ${module.name};`);\n      break;\n    case 'unscoped-interface-blocks':\n      glsl.push('};');\n      break;\n    case 'uniforms':\n      // ignore\n  }\n\n  // final new line\n  glsl.push('');\n\n  return glsl.join('\\n');\n}\n\n\n/** Map a luma.gl WebGPU style uniform type to GLSL */\nfunction getGLSLUniformType(uniformFormat: UniformFormat): string {\n  const UNIFORM_TYPE_TO_GLSL: Record<UniformFormat, string> = {\n    'f32': 'float',\n    'i32': 'int',\n    'u32': 'uint',\n    'vec2<f32>': 'vec2',\n    'vec3<f32>': 'vec3',\n    'vec4<f32>': 'vec4',\n    'vec2<i32>': 'ivec2',\n    'vec3<i32>': 'ivec3',\n    'vec4<i32>': 'ivec4',\n    'vec2<u32>': 'uvec2',\n    'vec3<u32>': 'uvec3',\n    'vec4<u32>': 'uvec4',\n    'mat2x2<f32>': 'mat2',\n    'mat2x3<f32>': 'mat2x3',\n    'mat2x4<f32>': 'mat2x4',\n    'mat3x2<f32>': 'mat3x2',\n    'mat3x3<f32>': 'mat3',\n    'mat3x4<f32>': 'mat3x4',\n    'mat4x2<f32>': 'mat4x2',\n    'mat4x3<f32>': 'mat4x3',\n    'mat4x4<f32>': 'mat4',\n  };\n  \n  const glsl = UNIFORM_TYPE_TO_GLSL[uniformFormat];\n  return glsl;\n}\n\n"],"mappings":"SAKQA,UAAU;AAOlB,OAAO,SAASC,qBAAqBA,CAACC,MAAoB,EAAEC,OAA8B,EAAE;EAC1F,OAAOC,+BAA+B,CAACF,MAAM,EAAEC,OAAO,CAAC;AACzD;AAEA,SAASC,+BAA+BA,CAACF,MAAoB,EAAEC,OAA8B,EAAU;EACrG,MAAME,IAAc,GAAG,EAAE;EAGzB,QAAQF,OAAO,CAACG,QAAQ;IACtB,KAAK,yBAAyB;IAC9B,KAAK,2BAA2B;MAC9BD,IAAI,CAACE,IAAI,CAAE,WAAUP,UAAU,CAACE,MAAM,CAACM,IAAI,CAAE,IAAG,CAAC;MACjD;IACF,KAAK,UAAU;EAEjB;EAEA,KAAK,MAAM,CAACC,WAAW,EAAEC,aAAa,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACV,MAAM,CAACW,YAAY,IAAI,CAAC,CAAC,CAAC,EAAE;IACpF,MAAMC,eAAe,GAAGC,kBAAkB,CAACL,aAAa,CAAC;IACzD,QAAQP,OAAO,CAACG,QAAQ;MACtB,KAAK,yBAAyB;QAE5BD,IAAI,CAACE,IAAI,CAAE,KAAIO,eAAgB,IAAGL,WAAY,GAAE,CAAC;QACjD;MACF,KAAK,2BAA2B;QAE9BJ,IAAI,CAACE,IAAI,CAAE,KAAIO,eAAgB,IAAGZ,MAAM,CAACM,IAAK,IAAGC,WAAY,GAAE,CAAC;QAChE;MACF,KAAK,UAAU;QACbJ,IAAI,CAACE,IAAI,CAAE,WAAUO,eAAgB,IAAGZ,MAAM,CAACM,IAAK,IAAGC,WAAY,GAAE,CAAC;IAC1E;EACF;EAEA,QAAQN,OAAO,CAACG,QAAQ;IACtB,KAAK,yBAAyB;MAC5BD,IAAI,CAACE,IAAI,CAAE,KAAIL,MAAM,CAACM,IAAK,GAAE,CAAC;MAC9B;IACF,KAAK,2BAA2B;MAC9BH,IAAI,CAACE,IAAI,CAAC,IAAI,CAAC;MACf;IACF,KAAK,UAAU;EAEjB;EAGAF,IAAI,CAACE,IAAI,CAAC,EAAE,CAAC;EAEb,OAAOF,IAAI,CAACW,IAAI,CAAC,IAAI,CAAC;AACxB;AAIA,SAASD,kBAAkBA,CAACL,aAA4B,EAAU;EAChE,MAAMO,oBAAmD,GAAG;IAC1D,KAAK,EAAE,OAAO;IACd,KAAK,EAAE,KAAK;IACZ,KAAK,EAAE,MAAM;IACb,WAAW,EAAE,MAAM;IACnB,WAAW,EAAE,MAAM;IACnB,WAAW,EAAE,MAAM;IACnB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,OAAO;IACpB,aAAa,EAAE,MAAM;IACrB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE,MAAM;IACrB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE,QAAQ;IACvB,aAAa,EAAE;EACjB,CAAC;EAED,MAAMZ,IAAI,GAAGY,oBAAoB,CAACP,aAAa,CAAC;EAChD,OAAOL,IAAI;AACb"}