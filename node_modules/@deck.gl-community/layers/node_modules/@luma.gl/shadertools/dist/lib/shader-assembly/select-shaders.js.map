{"version":3,"file":"select-shaders.js","names":["selectShaders","props","vs","Error","getShaderSource","platformInfo","fs","shader","type","wgsl","glsl"],"sources":["../../../src/lib/shader-assembly/select-shaders.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\n\nimport type {PlatformInfo} from './platform-info';\nimport type {AssembleShaderOptions} from './assemble-shaders';\n\n/**\n * Options for `ShaderAssembler.assembleShaders()`\n */\nexport type AssembleShaderProps = Omit<AssembleShaderOptions, 'vs' | 'fs'> & {\n  platformInfo: PlatformInfo;\n  /** Vertex shader source. Can be GLSL or WGSL or both */\n  vs?: {glsl?: string; wgsl?: string} | string | null;\n  /** Fragment shader source. Can be GLSL or WGSL or both */\n  fs?: {glsl?: string; wgsl?: string} | string | null;  \n};\n\n/**\n * Shader selection \n * @param device\n * @param props\n * @returns\n */\nexport function selectShaders(\n  props: AssembleShaderProps\n): AssembleShaderOptions {\n  if (!props.vs) {\n    throw new Error('no vertex shader');\n  }\n\n  // Resolve WGSL vs GLSL\n  const vs = getShaderSource(props.platformInfo, props.vs);\n  let fs;\n  if (props.fs) {\n    fs = getShaderSource(props.platformInfo, props.fs);\n  }\n\n  return {...props, vs, fs};\n}\n\n/** Create a shader from the different overloads */\nfunction getShaderSource(platformInfo: PlatformInfo, shader: string | {glsl?: string; wgsl?: string}): string {\n  // TODO - detect WGSL/GLSL and throw an error if not supported\n  if (typeof shader === 'string') {\n    return shader;\n  }\n\n  switch (platformInfo.type) {\n    case 'webgpu':\n      if (shader?.wgsl) {\n        return shader.wgsl;\n      }\n      throw new Error('WebGPU does not support GLSL shaders');\n\n    default:\n      if (shader?.glsl) {\n        return shader.glsl;\n      }\n      throw new Error('WebGL does not support WGSL shaders');\n  }\n}\n"],"mappings":"AAwBA,OAAO,SAASA,aAAaA,CAC3BC,KAA0B,EACH;EACvB,IAAI,CAACA,KAAK,CAACC,EAAE,EAAE;IACb,MAAM,IAAIC,KAAK,CAAC,kBAAkB,CAAC;EACrC;EAGA,MAAMD,EAAE,GAAGE,eAAe,CAACH,KAAK,CAACI,YAAY,EAAEJ,KAAK,CAACC,EAAE,CAAC;EACxD,IAAII,EAAE;EACN,IAAIL,KAAK,CAACK,EAAE,EAAE;IACZA,EAAE,GAAGF,eAAe,CAACH,KAAK,CAACI,YAAY,EAAEJ,KAAK,CAACK,EAAE,CAAC;EACpD;EAEA,OAAO;IAAC,GAAGL,KAAK;IAAEC,EAAE;IAAEI;EAAE,CAAC;AAC3B;AAGA,SAASF,eAAeA,CAACC,YAA0B,EAAEE,MAA+C,EAAU;EAE5G,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;IAC9B,OAAOA,MAAM;EACf;EAEA,QAAQF,YAAY,CAACG,IAAI;IACvB,KAAK,QAAQ;MACX,IAAID,MAAM,aAANA,MAAM,eAANA,MAAM,CAAEE,IAAI,EAAE;QAChB,OAAOF,MAAM,CAACE,IAAI;MACpB;MACA,MAAM,IAAIN,KAAK,CAAC,sCAAsC,CAAC;IAEzD;MACE,IAAII,MAAM,aAANA,MAAM,eAANA,MAAM,CAAEG,IAAI,EAAE;QAChB,OAAOH,MAAM,CAACG,IAAI;MACpB;MACA,MAAM,IAAIP,KAAK,CAAC,qCAAqC,CAAC;EAC1D;AACF"}