{"version":3,"file":"bulgepinch.js","names":["glsl","warp","fs","bulgePinch","name","uniformTypes","center","radius","strength","uniformPropTypes","value","min","softMax","max","dependencies","passes","sampler"],"sources":["../../../../src/modules/postprocessing/image-warp-filters/bulgepinch.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport {ShaderPass} from '../../../lib/shader-module/shader-pass';\nimport {glsl} from '../../../lib/glsl-utils/highlight';\nimport {warp} from './warp';\n\nconst fs = glsl`\\\nuniform bulgePinchUniforms {\n  float radius;\n  float strength;\n  vec2 center;\n} bulgePinch;\n\nvec2 bulgePinch_warp(vec2 coord, vec2 texCenter) {\n  coord -= texCenter;\n  float distance = length(coord);\n  if (distance < bulgePinch.radius) {\n    float percent = distance / bulgePinch.radius;\n    if (bulgePinch.strength > 0.0) {\n      coord *= mix(1.0, smoothstep(0.0, bulgePinch.radius / distance, percent), bulgePinch.strength * 0.75);\n    } else {\n      coord *= mix(1.0, pow(percent, 1.0 + bulgePinch.strength * 0.75) * bulgePinch.radius / distance, 1.0 - percent);\n    }\n  }\n  coord += texCenter;\n  return coord;\n}\n\nvec4 bulgePinch_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {\n  vec2 coord = texCoord * texSize;\n  coord = bulgePinch_warp(coord, bulgePinch.center * texSize);\n\n  return warp_sampleColor(source, texSize, coord);\n}\n`;\n\n/** Bulges or pinches the image in a circle. */\nexport type BulgePinchProps = {\n  /** The [x, y] coordinates of the center of the circle of effect. */\n  center?: number[];\n  /** The radius of the circle of effect. */\n  radius?: number;\n  /** strength -1 to 1 (-1 is strong pinch, 0 is no effect, 1 is strong bulge) */\n  strength?: number;\n};\n\n/**\n * Bulge / Pinch -\n * Bulges or pinches the image in a circle.\n */\nexport const bulgePinch: ShaderPass<BulgePinchProps, BulgePinchProps> = {\n  name: 'bulgePinch',\n  fs,\n  uniformTypes: {\n    center: 'vec2<f32>',\n    radius: 'f32',\n    strength: 'f32'\n  },\n  uniformPropTypes: {\n    center: {value: [0.5, 0.5]},\n    radius: {value: 200, min: 1, softMax: 600},\n    strength: {value: 0.5, min: -1, max: 1}\n  },\n  dependencies: [warp],\n  passes: [{sampler: true}]\n};\n"],"mappings":"SAIQA,IAAI;AAAA,SACJC,IAAI;AAEZ,MAAMC,EAAE,GAAGF,IAAK;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AAgBD,OAAO,MAAMG,UAAwD,GAAG;EACtEC,IAAI,EAAE,YAAY;EAClBF,EAAE;EACFG,YAAY,EAAE;IACZC,MAAM,EAAE,WAAW;IACnBC,MAAM,EAAE,KAAK;IACbC,QAAQ,EAAE;EACZ,CAAC;EACDC,gBAAgB,EAAE;IAChBH,MAAM,EAAE;MAACI,KAAK,EAAE,CAAC,GAAG,EAAE,GAAG;IAAC,CAAC;IAC3BH,MAAM,EAAE;MAACG,KAAK,EAAE,GAAG;MAAEC,GAAG,EAAE,CAAC;MAAEC,OAAO,EAAE;IAAG,CAAC;IAC1CJ,QAAQ,EAAE;MAACE,KAAK,EAAE,GAAG;MAAEC,GAAG,EAAE,CAAC,CAAC;MAAEE,GAAG,EAAE;IAAC;EACxC,CAAC;EACDC,YAAY,EAAE,CAACb,IAAI,CAAC;EACpBc,MAAM,EAAE,CAAC;IAACC,OAAO,EAAE;EAAI,CAAC;AAC1B,CAAC"}