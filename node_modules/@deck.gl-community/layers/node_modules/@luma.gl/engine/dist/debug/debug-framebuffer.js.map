{"version":3,"file":"debug-framebuffer.js","names":["canvas","ctx","debugFramebuffer","fbo","_ref","id","minimap","opaque","top","left","rgbaScale","document","createElement","title","style","zIndex","position","border","transform","body","appendChild","getContext","width","height","color","device","readPixelsToArrayWebGL","imageData","createImageData","offset","i","length","data","putImageData"],"sources":["../../src/debug/debug-framebuffer.ts"],"sourcesContent":["import type {Framebuffer, Texture} from '@luma.gl/core';\n// import {copyTextureToImage} from '../debug/copy-texture-to-image';\n\n/** Only works with 1st device? */\nlet canvas: HTMLCanvasElement | null = null;\nlet ctx: CanvasRenderingContext2D | null = null;\n// let targetImage: HTMLImageElement | null = null;\n\n/** Debug utility to draw FBO contents onto screen */\n// eslint-disable-next-line\nexport function debugFramebuffer(\n  fbo: Framebuffer | Texture,\n  {id, minimap, opaque, top = '0', left = '0', rgbaScale = 1}: {id: string, minimap?: boolean; opaque?: boolean, top?: string, left?: string, rgbaScale?: number}\n) {\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n    canvas.id = id;\n    canvas.title = id;\n    canvas.style.zIndex = '100';\n    canvas.style.position = 'absolute';\n    canvas.style.top = top; // ⚠️\n    canvas.style.left = left; // ⚠️\n    canvas.style.border = 'blue 1px solid';\n    canvas.style.transform = 'scaleY(-1)';\n    document.body.appendChild(canvas);\n\n    ctx = canvas.getContext('2d');\n    // targetImage = new Image();\n  }\n\n  // const canvasHeight = (minimap ? 2 : 1) * fbo.height;\n  if (canvas.width !== fbo.width || canvas.height !== fbo.height) {\n    canvas.width = fbo.width / 2;\n    canvas.height = fbo.height / 2;\n    canvas.style.width = '400px';\n    canvas.style.height = '400px';\n\n  }\n\n  // const image = copyTextureToImage(fbo, {targetMaxHeight: 100, targetImage});\n  // ctx.drawImage(image, 0, 0);\n\n  const color = fbo.device.readPixelsToArrayWebGL(fbo);\n  const imageData = ctx.createImageData(fbo.width, fbo.height);\n  // Full map\n  const offset = 0;\n  // if (color.some((v) => v > 0)) {\n  //   console.error('THERE IS NON-ZERO DATA IN THE FBO!');\n  // }\n  for (let i = 0; i < color.length; i += 4) {\n    imageData.data[offset + i + 0] = color[i + 0] * rgbaScale;\n    imageData.data[offset + i + 1] = color[i + 1] * rgbaScale;\n    imageData.data[offset + i + 2] = color[i + 2] * rgbaScale;\n    imageData.data[offset + i + 3] = opaque ? 255 : color[i + 3] * rgbaScale;\n  }\n  ctx.putImageData(imageData, 0, 0);\n};"],"mappings":"AAIA,IAAIA,MAAgC,GAAG,IAAI;AAC3C,IAAIC,GAAoC,GAAG,IAAI;AAK/C,OAAO,SAASC,gBAAgBA,CAC9BC,GAA0B,EAAAC,IAAA,EAE1B;EAAA,IADA;IAACC,EAAE;IAAEC,OAAO;IAAEC,MAAM;IAAEC,GAAG,GAAG,GAAG;IAAEC,IAAI,GAAG,GAAG;IAAEC,SAAS,GAAG;EAAqG,CAAC,GAAAN,IAAA;EAE/J,IAAI,CAACJ,MAAM,EAAE;IACXA,MAAM,GAAGW,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IACzCZ,MAAM,CAACK,EAAE,GAAGA,EAAE;IACdL,MAAM,CAACa,KAAK,GAAGR,EAAE;IACjBL,MAAM,CAACc,KAAK,CAACC,MAAM,GAAG,KAAK;IAC3Bf,MAAM,CAACc,KAAK,CAACE,QAAQ,GAAG,UAAU;IAClChB,MAAM,CAACc,KAAK,CAACN,GAAG,GAAGA,GAAG;IACtBR,MAAM,CAACc,KAAK,CAACL,IAAI,GAAGA,IAAI;IACxBT,MAAM,CAACc,KAAK,CAACG,MAAM,GAAG,gBAAgB;IACtCjB,MAAM,CAACc,KAAK,CAACI,SAAS,GAAG,YAAY;IACrCP,QAAQ,CAACQ,IAAI,CAACC,WAAW,CAACpB,MAAM,CAAC;IAEjCC,GAAG,GAAGD,MAAM,CAACqB,UAAU,CAAC,IAAI,CAAC;EAE/B;EAGA,IAAIrB,MAAM,CAACsB,KAAK,KAAKnB,GAAG,CAACmB,KAAK,IAAItB,MAAM,CAACuB,MAAM,KAAKpB,GAAG,CAACoB,MAAM,EAAE;IAC9DvB,MAAM,CAACsB,KAAK,GAAGnB,GAAG,CAACmB,KAAK,GAAG,CAAC;IAC5BtB,MAAM,CAACuB,MAAM,GAAGpB,GAAG,CAACoB,MAAM,GAAG,CAAC;IAC9BvB,MAAM,CAACc,KAAK,CAACQ,KAAK,GAAG,OAAO;IAC5BtB,MAAM,CAACc,KAAK,CAACS,MAAM,GAAG,OAAO;EAE/B;EAKA,MAAMC,KAAK,GAAGrB,GAAG,CAACsB,MAAM,CAACC,sBAAsB,CAACvB,GAAG,CAAC;EACpD,MAAMwB,SAAS,GAAG1B,GAAG,CAAC2B,eAAe,CAACzB,GAAG,CAACmB,KAAK,EAAEnB,GAAG,CAACoB,MAAM,CAAC;EAE5D,MAAMM,MAAM,GAAG,CAAC;EAIhB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGN,KAAK,CAACO,MAAM,EAAED,CAAC,IAAI,CAAC,EAAE;IACxCH,SAAS,CAACK,IAAI,CAACH,MAAM,GAAGC,CAAC,GAAG,CAAC,CAAC,GAAGN,KAAK,CAACM,CAAC,GAAG,CAAC,CAAC,GAAGpB,SAAS;IACzDiB,SAAS,CAACK,IAAI,CAACH,MAAM,GAAGC,CAAC,GAAG,CAAC,CAAC,GAAGN,KAAK,CAACM,CAAC,GAAG,CAAC,CAAC,GAAGpB,SAAS;IACzDiB,SAAS,CAACK,IAAI,CAACH,MAAM,GAAGC,CAAC,GAAG,CAAC,CAAC,GAAGN,KAAK,CAACM,CAAC,GAAG,CAAC,CAAC,GAAGpB,SAAS;IACzDiB,SAAS,CAACK,IAAI,CAACH,MAAM,GAAGC,CAAC,GAAG,CAAC,CAAC,GAAGvB,MAAM,GAAG,GAAG,GAAGiB,KAAK,CAACM,CAAC,GAAG,CAAC,CAAC,GAAGpB,SAAS;EAC1E;EACAT,GAAG,CAACgC,YAAY,CAACN,SAAS,EAAE,CAAC,EAAE,CAAC,CAAC;AACnC;AAAC"}