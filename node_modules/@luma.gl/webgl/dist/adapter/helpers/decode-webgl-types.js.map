{"version":3,"file":"decode-webgl-types.js","names":["isSamplerUniform","type","SAMPLER_TYPES","includes","COMPOSITE_GL_TYPES","decodeGLUniformType","glUniformType","typeAndSize","Error","glType","components","format","decodeGLAttributeType","glAttributeType","shaderType","vertexFormat","attributeType","decomposeCompositeGLDataType","compositeGLDataType","getCompositeGLDataType","compType","compComponents","name","Number"],"sources":["../../../src/adapter/helpers/decode-webgl-types.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport {ShaderUniformType, ShaderAttributeType, VertexFormat} from '@luma.gl/core';\nimport {GL, GLUniformType, GLSamplerType, GLCompositeType, GLDataType} from '@luma.gl/constants';\n\n/** Check is uniform is of sampler type */\nexport function isSamplerUniform(type: GLUniformType): boolean {\n  return SAMPLER_TYPES.includes(type as GLSamplerType);\n}\n\nconst SAMPLER_TYPES: GLSamplerType[] = [\n  GL.SAMPLER_2D,\n  GL.SAMPLER_CUBE,\n  GL.SAMPLER_3D,\n  GL.SAMPLER_2D_SHADOW,\n  GL.SAMPLER_2D_ARRAY,\n  GL.SAMPLER_2D_ARRAY_SHADOW,\n  GL.SAMPLER_CUBE_SHADOW,\n  GL.INT_SAMPLER_2D,\n  GL.INT_SAMPLER_3D,\n  GL.INT_SAMPLER_CUBE,\n  GL.INT_SAMPLER_2D_ARRAY,\n  GL.UNSIGNED_INT_SAMPLER_2D,\n  GL.UNSIGNED_INT_SAMPLER_3D,\n  GL.UNSIGNED_INT_SAMPLER_CUBE,\n  GL.UNSIGNED_INT_SAMPLER_2D_ARRAY\n];\n\n// Composite types table\nconst COMPOSITE_GL_TYPES: Record<\n  GLCompositeType,\n  [GLDataType, number, string, ShaderUniformType, VertexFormat?]\n> = {\n  [GL.FLOAT]: [GL.FLOAT, 1, 'float', 'f32', 'float32'],\n  [GL.FLOAT_VEC2]: [GL.FLOAT, 2, 'vec2', 'vec2<f32>', 'float32x2'],\n  [GL.FLOAT_VEC3]: [GL.FLOAT, 3, 'vec3', 'vec3<f32>', 'float32x3'],\n  [GL.FLOAT_VEC4]: [GL.FLOAT, 4, 'vec4', 'vec4<f32>', 'float32x4'],\n\n  [GL.INT]: [GL.INT, 1, 'int', 'i32', 'sint32'],\n  [GL.INT_VEC2]: [GL.INT, 2, 'ivec2', 'vec2<i32>', 'sint32x2'],\n  [GL.INT_VEC3]: [GL.INT, 3, 'ivec3', 'vec3<i32>', 'sint32x3'],\n  [GL.INT_VEC4]: [GL.INT, 4, 'ivec4', 'vec4<i32>', 'sint32x4'],\n\n  [GL.UNSIGNED_INT]: [GL.UNSIGNED_INT, 1, 'uint', 'u32', 'uint32'],\n  [GL.UNSIGNED_INT_VEC2]: [GL.UNSIGNED_INT, 2, 'uvec2', 'vec2<u32>', 'uint32x2'],\n  [GL.UNSIGNED_INT_VEC3]: [GL.UNSIGNED_INT, 3, 'uvec3', 'vec3<u32>', 'uint32x3'],\n  [GL.UNSIGNED_INT_VEC4]: [GL.UNSIGNED_INT, 4, 'uvec4', 'vec4<u32>', 'uint32x4'],\n\n  [GL.BOOL]: [GL.FLOAT, 1, 'bool', 'f32', 'float32'],\n  [GL.BOOL_VEC2]: [GL.FLOAT, 2, 'bvec2', 'vec2<f32>', 'float32x2'],\n  [GL.BOOL_VEC3]: [GL.FLOAT, 3, 'bvec3', 'vec3<f32>', 'float32x3'],\n  [GL.BOOL_VEC4]: [GL.FLOAT, 4, 'bvec4', 'vec4<f32>', 'float32x4'],\n\n  // TODO - are sizes/components below correct?\n  [GL.FLOAT_MAT2]: [GL.FLOAT, 8, 'mat2', 'mat2x2<f32>'], // 4\n  [GL.FLOAT_MAT2x3]: [GL.FLOAT, 8, 'mat2x3', 'mat2x3<f32>'], // 6\n  [GL.FLOAT_MAT2x4]: [GL.FLOAT, 8, 'mat2x4', 'mat2x4<f32>'], // 8\n\n  [GL.FLOAT_MAT3x2]: [GL.FLOAT, 12, 'mat3x2', 'mat3x2<f32>'], // 6\n  [GL.FLOAT_MAT3]: [GL.FLOAT, 12, 'mat3', 'mat3x3<f32>'], // 9\n  [GL.FLOAT_MAT3x4]: [GL.FLOAT, 12, 'mat3x4', 'mat3x4<f32>'], // 12\n\n  [GL.FLOAT_MAT4x2]: [GL.FLOAT, 16, 'mat4x2', 'mat4x2<f32>'], // 8\n  [GL.FLOAT_MAT4x3]: [GL.FLOAT, 16, 'mat4x3', 'mat4x3<f32>'], // 12\n  [GL.FLOAT_MAT4]: [GL.FLOAT, 16, 'mat4', 'mat4x4<f32>'] // 16\n};\n\n/** Decomposes a composite type (GL.VEC3) into a basic type (GL.FLOAT) and components (3) */\nexport function decodeGLUniformType(\n  glUniformType: GL\n): {format: ShaderUniformType; components: number; glType: GLDataType} {\n  const typeAndSize = COMPOSITE_GL_TYPES[glUniformType];\n  if (!typeAndSize) {\n    throw new Error('uniform');\n  }\n  const [glType, components, , format] = typeAndSize;\n  return {format, components, glType};\n}\n\n/** Decomposes a composite type (GL.VEC3) into a basic type (GL.FLOAT) and components (3) */\nexport function decodeGLAttributeType(glAttributeType: GL): {\n  attributeType: ShaderAttributeType;\n  vertexFormat: VertexFormat;\n  components: number;\n  // glType: GLDataType;\n} {\n  const typeAndSize = COMPOSITE_GL_TYPES[glAttributeType];\n  if (!typeAndSize) {\n    throw new Error('attribute')\n  }\n  const [, components, , shaderType, vertexFormat] = typeAndSize;\n  // TODO sanity - if (shaderType.startsWith('mat' ...))\n  const attributeType = shaderType as unknown as ShaderAttributeType\n  return {attributeType, vertexFormat, components}; // , glType};\n}\n\n/** Decomposes a composite type GL.VEC3 into a basic type (GL.FLOAT) and components (3) */\nexport function decomposeCompositeGLDataType(\n  compositeGLDataType: GLCompositeType\n): {type: GLDataType; components: number} | null {\n  const typeAndSize = COMPOSITE_GL_TYPES[compositeGLDataType];\n  if (!typeAndSize) {\n    return null;\n  }\n  const [type, components] = typeAndSize;\n  return {type, components};\n}\n\nexport function getCompositeGLDataType(type: GL, components): {glType: GLDataType; name: string} | null {\n  switch (type) {\n    case GL.BYTE:\n    case GL.UNSIGNED_BYTE:\n    case GL.SHORT:\n    case GL.UNSIGNED_SHORT:\n      type = GL.FLOAT;\n      break;\n    default:\n  }\n\n  for (const glType in COMPOSITE_GL_TYPES) {\n    const [compType, compComponents, name] = COMPOSITE_GL_TYPES[glType];\n    if (compType === type && compComponents === components) {\n      return {glType: Number(glType), name};\n    }\n  }\n  return null;\n}\n"],"mappings":"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"}