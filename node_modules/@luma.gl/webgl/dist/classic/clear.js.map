{"version":3,"file":"clear.js","names":["assert","WebGLDevice","withGLParameters","GL_DEPTH_BUFFER_BIT","GL_STENCIL_BUFFER_BIT","GL_COLOR_BUFFER_BIT","GL_COLOR","GL_DEPTH","GL_STENCIL","GL_DEPTH_STENCIL","ERR_ARGUMENTS","clear","gl","options","device","attach","framebuffer","color","depth","stencil","parameters","clearFlags","clearColor","clearDepth","clearStencil","clearBuffer","buffer","drawBuffer","value","gl2","constructor","Int32Array","clearBufferiv","Uint32Array","clearBufferuiv","Float32Array","clearBufferfv","clearBufferfi"],"sources":["../../src/classic/clear.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport {Device, Framebuffer, assert} from '@luma.gl/core';\nimport {WebGLDevice} from '../adapter/webgl-device';\nimport {withGLParameters} from '../context/state-tracker/with-parameters';\n\n// Should collapse during minification\nconst GL_DEPTH_BUFFER_BIT = 0x00000100;\nconst GL_STENCIL_BUFFER_BIT = 0x00000400;\nconst GL_COLOR_BUFFER_BIT = 0x00004000;\n\nconst GL_COLOR = 0x1800;\nconst GL_DEPTH = 0x1801;\nconst GL_STENCIL = 0x1802;\nconst GL_DEPTH_STENCIL = 0x84f9;\n\n// Should disappear if asserts are removed\nconst ERR_ARGUMENTS = 'clear: bad arguments';\n\n/** \n * Optionally clears depth, color and stencil buffers \n * @deprecated Set clear color when creating a RenderPass.\n */\nexport function clear(\n  gl: Device | WebGLRenderingContext,\n  options?: {framebuffer?: Framebuffer; color?: any; depth?: any; stencil?: any}\n): void {\n  const device = WebGLDevice.attach(gl);\n  const {framebuffer = null, color = null, depth = null, stencil = null} = options || {};\n  const parameters: any = {};\n\n  if (framebuffer) {\n    parameters.framebuffer = framebuffer;\n  }\n\n  let clearFlags = 0;\n\n  if (color) {\n    clearFlags |= GL_COLOR_BUFFER_BIT;\n    if (color !== true) {\n      parameters.clearColor = color;\n    }\n  }\n\n  if (depth) {\n    clearFlags |= GL_DEPTH_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearDepth = depth;\n    }\n  }\n\n  if (stencil) {\n    clearFlags |= GL_STENCIL_BUFFER_BIT;\n    if (depth !== true) {\n      parameters.clearStencil = depth;\n    }\n  }\n\n  assert(clearFlags !== 0, ERR_ARGUMENTS);\n\n  // Temporarily set any clear \"colors\" and call clear\n  withGLParameters(device.gl, parameters, () => {\n    device.gl.clear(clearFlags);\n  });\n}\n\n/** \n * WebGL2 - clear a specific drawing buffer \n * @deprecated Set clear color when creating a RenderPass\n */\nexport function clearBuffer(\n  gl: Device | WebGLRenderingContext,\n  options?: {framebuffer?: Framebuffer; buffer?: any; drawBuffer?: any; value?: any}\n) {\n  const device = WebGLDevice.attach(gl);\n\n  const {framebuffer = null, buffer = GL_COLOR, drawBuffer = 0, value = [0, 0, 0, 0]} = options || {};\n  withGLParameters(device.gl2, {framebuffer}, () => {\n    // Method selection per OpenGL ES 3 docs\n    switch (buffer) {\n      case GL_COLOR:\n        switch (value.constructor) {\n          case Int32Array:\n            device.gl2.clearBufferiv(buffer, drawBuffer, value);\n            break;\n          case Uint32Array:\n            device.gl2.clearBufferuiv(buffer, drawBuffer, value);\n            break;\n          case Float32Array:\n          default:\n            device.gl2.clearBufferfv(buffer, drawBuffer, value);\n        }\n        break;\n\n      case GL_DEPTH:\n        device.gl2.clearBufferfv(GL_DEPTH, 0, [value]);\n        break;\n\n      case GL_STENCIL:\n        device.gl2.clearBufferiv(GL_STENCIL, 0, [value]);\n        break;\n\n      case GL_DEPTH_STENCIL:\n        const [depth, stencil] = value;\n        device.gl2.clearBufferfi(GL_DEPTH_STENCIL, 0, depth, stencil);\n        break;\n\n      default:\n        assert(false, ERR_ARGUMENTS);\n    }\n  });\n}\n"],"mappings":"AAGA,SAA6BA,MAAM,QAAO,eAAe;AAAC,SAClDC,WAAW;AAAA,SACXC,gBAAgB;AAGxB,MAAMC,mBAAmB,GAAG,UAAU;AACtC,MAAMC,qBAAqB,GAAG,UAAU;AACxC,MAAMC,mBAAmB,GAAG,UAAU;AAEtC,MAAMC,QAAQ,GAAG,MAAM;AACvB,MAAMC,QAAQ,GAAG,MAAM;AACvB,MAAMC,UAAU,GAAG,MAAM;AACzB,MAAMC,gBAAgB,GAAG,MAAM;AAG/B,MAAMC,aAAa,GAAG,sBAAsB;AAM5C,OAAO,SAASC,KAAKA,CACnBC,EAAkC,EAClCC,OAA8E,EACxE;EACN,MAAMC,MAAM,GAAGb,WAAW,CAACc,MAAM,CAACH,EAAE,CAAC;EACrC,MAAM;IAACI,WAAW,GAAG,IAAI;IAAEC,KAAK,GAAG,IAAI;IAAEC,KAAK,GAAG,IAAI;IAAEC,OAAO,GAAG;EAAI,CAAC,GAAGN,OAAO,IAAI,CAAC,CAAC;EACtF,MAAMO,UAAe,GAAG,CAAC,CAAC;EAE1B,IAAIJ,WAAW,EAAE;IACfI,UAAU,CAACJ,WAAW,GAAGA,WAAW;EACtC;EAEA,IAAIK,UAAU,GAAG,CAAC;EAElB,IAAIJ,KAAK,EAAE;IACTI,UAAU,IAAIhB,mBAAmB;IACjC,IAAIY,KAAK,KAAK,IAAI,EAAE;MAClBG,UAAU,CAACE,UAAU,GAAGL,KAAK;IAC/B;EACF;EAEA,IAAIC,KAAK,EAAE;IACTG,UAAU,IAAIlB,mBAAmB;IACjC,IAAIe,KAAK,KAAK,IAAI,EAAE;MAClBE,UAAU,CAACG,UAAU,GAAGL,KAAK;IAC/B;EACF;EAEA,IAAIC,OAAO,EAAE;IACXE,UAAU,IAAIjB,qBAAqB;IACnC,IAAIc,KAAK,KAAK,IAAI,EAAE;MAClBE,UAAU,CAACI,YAAY,GAAGN,KAAK;IACjC;EACF;EAEAlB,MAAM,CAACqB,UAAU,KAAK,CAAC,EAAEX,aAAa,CAAC;EAGvCR,gBAAgB,CAACY,MAAM,CAACF,EAAE,EAAEQ,UAAU,EAAE,MAAM;IAC5CN,MAAM,CAACF,EAAE,CAACD,KAAK,CAACU,UAAU,CAAC;EAC7B,CAAC,CAAC;AACJ;AAMA,OAAO,SAASI,WAAWA,CACzBb,EAAkC,EAClCC,OAAkF,EAClF;EACA,MAAMC,MAAM,GAAGb,WAAW,CAACc,MAAM,CAACH,EAAE,CAAC;EAErC,MAAM;IAACI,WAAW,GAAG,IAAI;IAAEU,MAAM,GAAGpB,QAAQ;IAAEqB,UAAU,GAAG,CAAC;IAAEC,KAAK,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;EAAC,CAAC,GAAGf,OAAO,IAAI,CAAC,CAAC;EACnGX,gBAAgB,CAACY,MAAM,CAACe,GAAG,EAAE;IAACb;EAAW,CAAC,EAAE,MAAM;IAEhD,QAAQU,MAAM;MACZ,KAAKpB,QAAQ;QACX,QAAQsB,KAAK,CAACE,WAAW;UACvB,KAAKC,UAAU;YACbjB,MAAM,CAACe,GAAG,CAACG,aAAa,CAACN,MAAM,EAAEC,UAAU,EAAEC,KAAK,CAAC;YACnD;UACF,KAAKK,WAAW;YACdnB,MAAM,CAACe,GAAG,CAACK,cAAc,CAACR,MAAM,EAAEC,UAAU,EAAEC,KAAK,CAAC;YACpD;UACF,KAAKO,YAAY;UACjB;YACErB,MAAM,CAACe,GAAG,CAACO,aAAa,CAACV,MAAM,EAAEC,UAAU,EAAEC,KAAK,CAAC;QACvD;QACA;MAEF,KAAKrB,QAAQ;QACXO,MAAM,CAACe,GAAG,CAACO,aAAa,CAAC7B,QAAQ,EAAE,CAAC,EAAE,CAACqB,KAAK,CAAC,CAAC;QAC9C;MAEF,KAAKpB,UAAU;QACbM,MAAM,CAACe,GAAG,CAACG,aAAa,CAACxB,UAAU,EAAE,CAAC,EAAE,CAACoB,KAAK,CAAC,CAAC;QAChD;MAEF,KAAKnB,gBAAgB;QACnB,MAAM,CAACS,KAAK,EAAEC,OAAO,CAAC,GAAGS,KAAK;QAC9Bd,MAAM,CAACe,GAAG,CAACQ,aAAa,CAAC5B,gBAAgB,EAAE,CAAC,EAAES,KAAK,EAAEC,OAAO,CAAC;QAC7D;MAEF;QACEnB,MAAM,CAAC,KAAK,EAAEU,aAAa,CAAC;IAChC;EACF,CAAC,CAAC;AACJ"}