{"version":3,"file":"accessor.js","names":["assert","checkProps","getTypedArrayFromGLType","DEFAULT_ACCESSOR_VALUES","offset","stride","type","size","divisor","normalized","integer","PROP_CHECKS","deprecatedProps","instanced","isInstanced","Accessor","getBytesPerElement","accessor","ArrayType","BYTES_PER_ELEMENT","getBytesPerVertex","resolve","_len","arguments","length","accessors","Array","_key","constructor","buffer","index","_len2","_key2","forEach","_assign","Object","freeze","toString","JSON","stringify","BYTES_PER_VERTEX","props","undefined","normalize"],"sources":["../../src/classic/accessor.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport {assert, checkProps, Buffer, AccessorObject} from '@luma.gl/core';\nimport {GL} from '@luma.gl/constants';\nimport {getTypedArrayFromGLType} from './typed-array-utils';\n\nconst DEFAULT_ACCESSOR_VALUES = {\n  offset: 0,\n  stride: 0,\n  type: GL.FLOAT,\n  size: 1,\n  divisor: 0,\n  normalized: false,\n  integer: false\n};\n\nconst PROP_CHECKS = {\n  deprecatedProps: {\n    instanced: 'divisor',\n    isInstanced: 'divisor'\n  }\n};\n\nexport class Accessor implements AccessorObject {\n  offset?: number;\n  stride?: number;\n  type?: number;\n  size?: number;\n  divisor?: number;\n  normalized?: boolean;\n  integer?: boolean;\n\n  buffer?: Buffer;\n  index?: number;\n\n  static getBytesPerElement(accessor: Accessor | AccessorObject): number {\n    // TODO: using `FLOAT` when type is not specified,\n    // ensure this assumption is valid or force API to specify type.\n    const ArrayType = getTypedArrayFromGLType(accessor.type || GL.FLOAT);\n    return ArrayType.BYTES_PER_ELEMENT;\n  }\n\n  static getBytesPerVertex(accessor: AccessorObject): number {\n    assert(accessor.size);\n    // TODO: using `FLOAT` when type is not specified,\n    // ensure this assumption is valid or force API to specify type.\n    const ArrayType = getTypedArrayFromGLType(accessor.type || GL.FLOAT);\n    return ArrayType.BYTES_PER_ELEMENT * accessor.size;\n  }\n\n  // Combines (merges) a list of accessors. On top of default values\n  // Usually [programAccessor, bufferAccessor, appAccessor]\n  // All props will be set in the returned object.\n  // TODO check for conflicts between values in the supplied accessors\n  static resolve(...accessors: AccessorObject[]): Accessor {\n    return new Accessor(...[DEFAULT_ACCESSOR_VALUES, ...accessors]); // Default values\n  }\n\n  constructor(...accessors: AccessorObject[]) {\n    accessors.forEach((accessor) => this._assign(accessor)); // Merge in sequence\n    Object.freeze(this);\n  }\n\n  toString(): string {\n    return JSON.stringify(this);\n  }\n\n  // ACCESSORS\n\n  // TODO - remove>\n  get BYTES_PER_ELEMENT(): number {\n    return Accessor.getBytesPerElement(this);\n  }\n\n  get BYTES_PER_VERTEX(): number {\n    return Accessor.getBytesPerVertex(this);\n  }\n\n  // PRIVATE\n\n  // eslint-disable-next-line complexity, max-statements\n  _assign(props: AccessorObject = {}): this {\n    props = checkProps('Accessor', props, PROP_CHECKS);\n\n    if (props.type !== undefined) {\n      this.type = props.type;\n\n      // Auto-deduce integer type?\n      if ((props.type as GL) === GL.INT || (props.type as GL) === GL.UNSIGNED_INT) {\n        this.integer = true;\n      }\n    }\n    if (props.size !== undefined) {\n      this.size = props.size;\n    }\n    if (props.offset !== undefined) {\n      this.offset = props.offset;\n    }\n    if (props.stride !== undefined) {\n      this.stride = props.stride;\n    }\n    // @ts-expect-error\n    if (props.normalize !== undefined) {\n      // @ts-expect-error\n      this.normalized = props.normalize;\n    }\n    if (props.normalized !== undefined) {\n      this.normalized = props.normalized;\n    }\n    if (props.integer !== undefined) {\n      this.integer = props.integer;\n    }\n\n    // INSTANCE DIVISOR\n    if (props.divisor !== undefined) {\n      this.divisor = props.divisor;\n    }\n\n    // Buffer is optional\n    if (props.buffer !== undefined) {\n      this.buffer = props.buffer;\n    }\n\n    // The binding index (for binding e.g. Transform feedbacks and Uniform buffers)\n    // TODO - should this be part of accessor?\n    if (props.index !== undefined) {\n      if (typeof props.index === 'boolean') {\n        this.index = props.index ? 1 : 0;\n      } else {\n        this.index = props.index;\n      }\n    }\n\n    // DEPRECATED\n    // @ts-expect-error\n    if (props.instanced !== undefined) {\n      // @ts-expect-error\n      this.divisor = props.instanced ? 1 : 0;\n    }\n    // @ts-expect-error\n    if (props.isInstanced !== undefined) {\n      // @ts-expect-error\n      this.divisor = props.isInstanced ? 1 : 0;\n    }\n\n    if (this.offset === undefined) delete this.offset;\n    if (this.stride === undefined) delete this.stride;\n    if (this.type === undefined) delete this.type;\n    if (this.size === undefined) delete this.size;\n    if (this.divisor === undefined) delete this.divisor;\n    if (this.normalized === undefined) delete this.normalized;\n    if (this.integer === undefined) delete this.integer;\n  \n    if (this.buffer === undefined) delete this.buffer;\n    if (this.index === undefined) delete this.index;\n  \n    return this;\n  }\n}\n\n// TEST EXPORTS\nexport {DEFAULT_ACCESSOR_VALUES};\n"],"mappings":"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"}