{"version":3,"file":"with-parameters.js","names":["WebGLDevice","setGLParameters","pushContextState","popContextState","withGLParameters","device","parameters","func","webglDevice","attach","gl","isObjectEmpty","nocatch","value","object","key"],"sources":["../../../src/context/state-tracker/with-parameters.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nimport type {Device} from '@luma.gl/core';\nimport {WebGLDevice} from '../../adapter/webgl-device';\nimport {GLParameters, setGLParameters} from '../parameters/unified-parameter-api';\nimport {pushContextState, popContextState} from './track-context-state';\n\n/**\n * Execute a function with a set of temporary WebGL parameter overrides\n * - Saves current \"global\" WebGL context settings\n * - Sets the supplies WebGL context parameters,\n * - Executes supplied function\n * - Restores parameters\n * - Returns the return value of the supplied function\n */\nexport function withGLParameters(device: Device | WebGLRenderingContext, parameters: GLParameters & {nocatch?: boolean}, func: any): any {\n  const webglDevice = WebGLDevice.attach(device);\n  const gl = webglDevice.gl;\n\n  if (isObjectEmpty(parameters)) {\n    // Avoid setting state if no parameters provided. Just call and return\n    return func(device);\n  }\n\n  const {nocatch = true} = parameters;\n\n  pushContextState(gl);\n  setGLParameters(gl, parameters);\n\n  // Setup is done, call the function\n  let value;\n\n  if (nocatch) {\n    // Avoid try catch to minimize stack size impact for safe execution paths\n    value = func(gl);\n    popContextState(gl);\n  } else {\n    // Wrap in a try-catch to ensure that parameters are restored on exceptions\n    try {\n      value = func(gl);\n    } finally {\n      popContextState(gl);\n    }\n  }\n\n  return value;\n}\n\n// Helpers\n\n// Returns true if given object is empty, false otherwise.\nfunction isObjectEmpty(object) {\n  // @ts-ignore - dummy key variable\n  for (const key in object) {\n    return false;\n  }\n  return true;\n}\n"],"mappings":"SAIQA,WAAW;AAAA,SACGC,eAAe;AAAA,SAC7BC,gBAAgB,EAAEC,eAAe;AAUzC,OAAO,SAASC,gBAAgBA,CAACC,MAAsC,EAAEC,UAA8C,EAAEC,IAAS,EAAO;EACvI,MAAMC,WAAW,GAAGR,WAAW,CAACS,MAAM,CAACJ,MAAM,CAAC;EAC9C,MAAMK,EAAE,GAAGF,WAAW,CAACE,EAAE;EAEzB,IAAIC,aAAa,CAACL,UAAU,CAAC,EAAE;IAE7B,OAAOC,IAAI,CAACF,MAAM,CAAC;EACrB;EAEA,MAAM;IAACO,OAAO,GAAG;EAAI,CAAC,GAAGN,UAAU;EAEnCJ,gBAAgB,CAACQ,EAAE,CAAC;EACpBT,eAAe,CAACS,EAAE,EAAEJ,UAAU,CAAC;EAG/B,IAAIO,KAAK;EAET,IAAID,OAAO,EAAE;IAEXC,KAAK,GAAGN,IAAI,CAACG,EAAE,CAAC;IAChBP,eAAe,CAACO,EAAE,CAAC;EACrB,CAAC,MAAM;IAEL,IAAI;MACFG,KAAK,GAAGN,IAAI,CAACG,EAAE,CAAC;IAClB,CAAC,SAAS;MACRP,eAAe,CAACO,EAAE,CAAC;IACrB;EACF;EAEA,OAAOG,KAAK;AACd;AAKA,SAASF,aAAaA,CAACG,MAAM,EAAE;EAE7B,KAAK,MAAMC,GAAG,IAAID,MAAM,EAAE;IACxB,OAAO,KAAK;EACd;EACA,OAAO,IAAI;AACb"}