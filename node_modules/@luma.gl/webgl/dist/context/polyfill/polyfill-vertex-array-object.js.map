{"version":3,"file":"polyfill-vertex-array-object.js","names":["glErrorShadow","error","msg","globalThis","console","log","synthesizeGLError","err","opt_msg","undefined","wrapGLError","gl","f","getError","apply","parseInt","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","VertexAttrib","maxAttrib","enabled","buffer","size","type","normalized","stride","offset","cached","recache","prototype","join","OESVertexArrayObject","self","original","getParameter","enableVertexAttribArray","disableVertexAttribArray","bindBuffer","getVertexAttrib","vertexAttribPointer","pname","VERTEX_ARRAY_BINDING_OES","currentVertexArrayObject","defaultVertexArrayObject","arguments","index","vao","Math","max","target","currentArrayBuffer","indx","instrumentExtension","canvas","addEventListener","reset_","contextWasLost","vertexArrayObjects","ii","bindVertexArrayOES","createVertexArrayOES","arrayObject","push","deleteVertexArrayOES","splice","indexOf","isVertexArrayOES","oldVAO","newVAO","call","currentBinding","oldAttrib","bufferChanged","polyfillVertexArrayObject","createVertexArray","original_getSupportedExtensions","getSupportedExtensions","list","original_getExtension","getExtension","name","__OESVertexArrayObject"],"sources":["../../../src/context/polyfill/polyfill-vertex-array-object.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\n/*\n ** Copyright (c) 2015 The Khronos Group Inc.\n **\n ** Permission is hereby granted, free of charge, to any person obtaining a\n ** copy of this software and/or associated documentation files (the\n ** \"Materials\"), to deal in the Materials without restriction, including\n ** without limitation the rights to use, copy, modify, merge, publish,\n ** distribute, sublicense, and/or sell copies of the Materials, and to\n ** permit persons to whom the Materials are furnished to do so, subject to\n ** the following conditions:\n **\n ** The above copyright notice and this permission notice shall be included\n ** in all copies or substantial portions of the Materials.\n **\n ** THE MATERIALS ARE PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n ** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n ** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n ** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n ** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n ** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n ** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n */\n\n// Modified to use ES6 and polyfill a provided context rather than\n// the global class.\n\n// @ts-nocheck external code\n/* eslint-disable */ \n\nconst glErrorShadow = {};\n\nfunction error(msg) {\n  if (globalThis.console && globalThis.console.error) {\n    globalThis.console.error(msg);\n  }\n}\n\nfunction log(msg) {\n  if (globalThis.console && globalThis.console.log) {\n    globalThis.console.log(msg);\n  }\n}\n\nfunction synthesizeGLError(err, opt_msg) {\n  glErrorShadow[err] = true;\n  if (opt_msg !== undefined) {\n    error(opt_msg);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const f = gl.getError;\n  gl.getError = function getError() {\n    let err;\n    do {\n      err = f.apply(gl);\n      if (err !== gl.NO_ERROR) {\n        glErrorShadow[err] = true;\n      }\n    } while (err !== gl.NO_ERROR);\n\n    for (err in glErrorShadow) {\n      if (glErrorShadow[err]) {\n        delete glErrorShadow[err];\n        return parseInt(err, 10);\n      }\n    }\n\n    return gl.NO_ERROR;\n  };\n}\n\nconst WebGLVertexArrayObjectOES = function WebGLVertexArrayObjectOES(ext) {\n  const gl = ext.gl;\n\n  this.ext = ext;\n  this.isAlive = true;\n  this.hasBeenBound = false;\n\n  this.elementArrayBuffer = null;\n  this.attribs = new Array(ext.maxVertexAttribs);\n  for (let n = 0; n < this.attribs.length; n++) {\n    const attrib = new WebGLVertexArrayObjectOES.VertexAttrib(gl);\n    this.attribs[n] = attrib;\n  }\n\n  this.maxAttrib = 0;\n};\n\nWebGLVertexArrayObjectOES.VertexAttrib = function VertexAttrib(gl) {\n  this.enabled = false;\n  this.buffer = null;\n  this.size = 4;\n  this.type = gl.FLOAT;\n  this.normalized = false;\n  this.stride = 16;\n  this.offset = 0;\n\n  this.cached = '';\n  this.recache();\n};\nWebGLVertexArrayObjectOES.VertexAttrib.prototype.recache = function recache() {\n  this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n};\n\nconst OESVertexArrayObject = function OESVertexArrayObject(gl) {\n  // eslint-disable-next-line @typescript-eslint/no-this-alias\n  const self = this;\n  this.gl = gl;\n\n  wrapGLError(gl);\n\n  const original = (this.original = {\n    getParameter: gl.getParameter,\n    enableVertexAttribArray: gl.enableVertexAttribArray,\n    disableVertexAttribArray: gl.disableVertexAttribArray,\n    bindBuffer: gl.bindBuffer,\n    getVertexAttrib: gl.getVertexAttrib,\n    vertexAttribPointer: gl.vertexAttribPointer\n  });\n\n  gl.getParameter = function getParameter(pname) {\n    if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n      if (self.currentVertexArrayObject === self.defaultVertexArrayObject) {\n        return null;\n      }\n      return self.currentVertexArrayObject;\n    }\n    return original.getParameter.apply(this, arguments);\n  };\n\n  gl.enableVertexAttribArray = function enableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = true;\n    return original.enableVertexAttribArray.apply(this, arguments);\n  };\n  gl.disableVertexAttribArray = function disableVertexAttribArray(index) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, index);\n    const attrib = vao.attribs[index];\n    attrib.enabled = false;\n    return original.disableVertexAttribArray.apply(this, arguments);\n  };\n\n  gl.bindBuffer = function bindBuffer(target, buffer) {\n    switch (target) {\n      case gl.ARRAY_BUFFER:\n        self.currentArrayBuffer = buffer;\n        break;\n      case gl.ELEMENT_ARRAY_BUFFER:\n        self.currentVertexArrayObject.elementArrayBuffer = buffer;\n        break;\n      default:\n    }\n    return original.bindBuffer.apply(this, arguments);\n  };\n\n  gl.getVertexAttrib = function getVertexAttrib(index, pname) {\n    const vao = self.currentVertexArrayObject;\n    const attrib = vao.attribs[index];\n    switch (pname) {\n      case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n        return attrib.buffer;\n      case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n        return attrib.enabled;\n      case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n        return attrib.size;\n      case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n        return attrib.stride;\n      case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n        return attrib.type;\n      case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n        return attrib.normalized;\n      default:\n        return original.getVertexAttrib.apply(this, arguments);\n    }\n  };\n\n  // eslint-disable-next-line max-params\n  gl.vertexAttribPointer = function vertexAttribPointer(\n    indx,\n    size,\n    type,\n    normalized,\n    stride,\n    offset\n  ) {\n    const vao = self.currentVertexArrayObject;\n    vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n    const attrib = vao.attribs[indx];\n    attrib.buffer = self.currentArrayBuffer;\n    attrib.size = size;\n    attrib.type = type;\n    attrib.normalized = normalized;\n    attrib.stride = stride;\n    attrib.offset = offset;\n    attrib.recache();\n    return original.vertexAttribPointer.apply(this, arguments);\n  };\n\n  if (gl.instrumentExtension) {\n    gl.instrumentExtension(this, 'OES_vertex_array_object');\n  }\n\n  // undefined for headless gl\n  if (gl.canvas) {\n    gl.canvas.addEventListener(\n      'webglcontextrestored',\n      () => {\n        log('OESVertexArrayObject emulation library context restored');\n        self.reset_();\n      },\n      true\n    );\n  }\n\n  this.reset_();\n};\n\nOESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES = 0x85b5;\n\nOESVertexArrayObject.prototype.reset_ = function reset_() {\n  const contextWasLost = this.vertexArrayObjects !== undefined;\n  if (contextWasLost) {\n    for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n      this.vertexArrayObjects.isAlive = false;\n    }\n  }\n  const gl = this.gl;\n  this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n  this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n  this.currentVertexArrayObject = null;\n  this.currentArrayBuffer = null;\n  this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n  this.bindVertexArrayOES(null);\n};\n\nOESVertexArrayObject.prototype.createVertexArrayOES = function createVertexArrayOES() {\n  const arrayObject = new WebGLVertexArrayObjectOES(this);\n  this.vertexArrayObjects.push(arrayObject);\n  return arrayObject;\n};\n\nOESVertexArrayObject.prototype.deleteVertexArrayOES = function deleteVertexArrayOES(arrayObject) {\n  arrayObject.isAlive = false;\n  this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n  if (this.currentVertexArrayObject === arrayObject) {\n    this.bindVertexArrayOES(null);\n  }\n};\n\nOESVertexArrayObject.prototype.isVertexArrayOES = function isVertexArrayOES(arrayObject) {\n  if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n    if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n      return true;\n    }\n  }\n  return false;\n};\n\nOESVertexArrayObject.prototype.bindVertexArrayOES = function bindVertexArrayOES(arrayObject) {\n  const gl = this.gl;\n  if (arrayObject && !arrayObject.isAlive) {\n    synthesizeGLError(\n      gl.INVALID_OPERATION,\n      'bindVertexArrayOES: attempt to bind deleted arrayObject'\n    );\n    return;\n  }\n  const original = this.original;\n\n  const oldVAO = this.currentVertexArrayObject;\n  this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n  this.currentVertexArrayObject.hasBeenBound = true;\n  const newVAO = this.currentVertexArrayObject;\n\n  if (oldVAO === newVAO) {\n    return;\n  }\n\n  if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n    original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n  }\n\n  let currentBinding = this.currentArrayBuffer;\n  const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n  for (let n = 0; n <= maxAttrib; n++) {\n    const attrib = newVAO.attribs[n];\n    const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n    if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n      if (attrib.enabled) {\n        original.enableVertexAttribArray.call(gl, n);\n      } else {\n        original.disableVertexAttribArray.call(gl, n);\n      }\n    }\n\n    if (attrib.enabled) {\n      let bufferChanged = false;\n      if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n        if (currentBinding !== attrib.buffer) {\n          original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n          currentBinding = attrib.buffer;\n        }\n        bufferChanged = true;\n      }\n\n      if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n        original.vertexAttribPointer.call(\n          gl,\n          n,\n          attrib.size,\n          attrib.type,\n          attrib.normalized,\n          attrib.stride,\n          attrib.offset\n        );\n      }\n    }\n  }\n\n  if (this.currentArrayBuffer !== currentBinding) {\n    original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n  }\n};\n\nexport function polyfillVertexArrayObject(gl) {\n  if (typeof gl.createVertexArray === 'function') {\n    // VAOs directly supported on object (i.e. WebGL 2 context)\n    return;\n  }\n\n  const original_getSupportedExtensions = gl.getSupportedExtensions;\n  gl.getSupportedExtensions = function getSupportedExtensions() {\n    const list = original_getSupportedExtensions.call(this) || [];\n    if (list.indexOf('OES_vertex_array_object') < 0) {\n      list.push('OES_vertex_array_object');\n    }\n    return list;\n  };\n\n  const original_getExtension = gl.getExtension;\n  gl.getExtension = function getExtension(name) {\n    const ext = original_getExtension.call(this, name);\n    if (ext) {\n      return ext;\n    }\n    if (name !== 'OES_vertex_array_object') {\n      return null;\n    }\n\n    if (!gl.__OESVertexArrayObject) {\n      this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n    }\n    return this.__OESVertexArrayObject;\n  };\n}\n"],"mappings":"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"}