{"version":3,"file":"get-parameter-polyfill.js","names":["isWebGL2","OES_element_index","WEBGL_draw_buffers","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","WEBGL_debug_renderer_info","GL_FRAGMENT_SHADER_DERIVATIVE_HINT","GL_DONT_CARE","GL_GPU_DISJOINT_EXT","GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT","GL_UNMASKED_VENDOR_WEBGL","GL_UNMASKED_RENDERER_WEBGL","getWebGL2ValueOrZero","gl","undefined","WEBGL_PARAMETERS","getParameter","ext","getExtension","GPU_DISJOINT_EXT","UNMASKED_VENDOR_WEBGL","UNMASKED_RENDERER_WEBGL","_gl$luma","luma","extensions","MAX_TEXTURE_MAX_ANISOTROPY_EXT","MAX_COLOR_ATTACHMENTS_WEBGL","MAX_DRAW_BUFFERS_WEBGL","getParameterPolyfill","originalGetParameter","pname","limit","value","result"],"sources":["../../../src/context/polyfill/get-parameter-polyfill.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\n/* eslint-disable no-inline-comments, max-len, camelcase */\nimport {GL} from '@luma.gl/constants';\nimport {isWebGL2} from '../context/webgl-checks';\n\nconst OES_element_index = 'OES_element_index';\nconst WEBGL_draw_buffers = 'WEBGL_draw_buffers';\nconst EXT_disjoint_timer_query = 'EXT_disjoint_timer_query';\nconst EXT_disjoint_timer_query_webgl2 = 'EXT_disjoint_timer_query_webgl2';\nconst EXT_texture_filter_anisotropic = 'EXT_texture_filter_anisotropic';\nconst WEBGL_debug_renderer_info = 'WEBGL_debug_renderer_info';\n\nconst GL_FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8b8b;\nconst GL_DONT_CARE = 0x1100;\nconst GL_GPU_DISJOINT_EXT = 0x8fbb;\nconst GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT = 0x84ff;\nconst GL_UNMASKED_VENDOR_WEBGL = 0x9245; // vendor string of the graphics driver.\nconst GL_UNMASKED_RENDERER_WEBGL = 0x9246; // renderer string of the graphics driver.\n\nconst getWebGL2ValueOrZero = (gl) => (!isWebGL2(gl) ? 0 : undefined);\n\n// if a function returns undefined in this table,\n// the original getParameter will be called, defeating the override\nconst WEBGL_PARAMETERS = {\n  [GL.READ_BUFFER]: (gl) => (!isWebGL2(gl) ? GL.COLOR_ATTACHMENT0 : undefined),\n\n  // WebGL2 context parameters\n  [GL_FRAGMENT_SHADER_DERIVATIVE_HINT]: (gl) => (!isWebGL2(gl) ? GL_DONT_CARE : undefined),\n\n  [GL.RASTERIZER_DISCARD]: getWebGL2ValueOrZero,\n\n  [GL.SAMPLES]: getWebGL2ValueOrZero,\n\n  // WebGL2 extension context parameters\n  [GL_GPU_DISJOINT_EXT]: (gl: WebGLRenderingContext, getParameter) => {\n    const ext = isWebGL2(gl)\n      ? gl.getExtension(EXT_disjoint_timer_query_webgl2)\n      : gl.getExtension(EXT_disjoint_timer_query);\n    return ext && ext.GPU_DISJOINT_EXT ? getParameter(ext.GPU_DISJOINT_EXT) : 0;\n  },\n\n  // Extension fixed values\n  [GL_UNMASKED_VENDOR_WEBGL]: (gl: WebGLRenderingContext, getParameter) => {\n    const ext = gl.getExtension(WEBGL_debug_renderer_info);\n    return getParameter((ext && ext.UNMASKED_VENDOR_WEBGL) || GL.VENDOR);\n  },\n\n  [GL_UNMASKED_RENDERER_WEBGL]: (gl: WebGLRenderingContext, getParameter) => {\n    const ext = gl.getExtension(WEBGL_debug_renderer_info);\n    return getParameter((ext && ext.UNMASKED_RENDERER_WEBGL) || GL.RENDERER);\n  },\n\n  // Extension LIMITS\n  [GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT]: (gl: WebGLRenderingContext, getParameter) => {\n    // @ts-ignore TODO - store these on the device instance instead...\n    const ext = gl.luma?.extensions?.[EXT_texture_filter_anisotropic] ||\n      gl.getExtension('EXT_texture_filter_anisotropic');\n    return ext ? getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT) : 1.0;\n  },\n\n  // WebGL2 Limits\n  [GL.MAX_3D_TEXTURE_SIZE]: getWebGL2ValueOrZero,\n  [GL.MAX_ARRAY_TEXTURE_LAYERS]: getWebGL2ValueOrZero,\n  [GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]: getWebGL2ValueOrZero,\n  [GL.MAX_COLOR_ATTACHMENTS]: (gl: WebGLRenderingContext, getParameter) => {\n    if (!isWebGL2(gl)) {\n      const ext = gl.getExtension(WEBGL_draw_buffers);\n      return ext ? getParameter(ext.MAX_COLOR_ATTACHMENTS_WEBGL) : 0;\n    }\n    return undefined;\n  },\n  [GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_COMBINED_UNIFORM_BLOCKS]: getWebGL2ValueOrZero,\n  [GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_DRAW_BUFFERS]: (gl) => {\n    if (!isWebGL2(gl)) {\n      const ext = gl.getExtension(WEBGL_draw_buffers);\n      return ext ? ext.MAX_DRAW_BUFFERS_WEBGL : 0;\n    }\n    return undefined;\n  },\n  [GL.MAX_ELEMENT_INDEX]:\n    // Guess: per webglstats.com 99.6% of webgl2 supports 2147483647\n    (gl) => (gl.getExtension(OES_element_index) ? 2147483647 : 65535),\n  [GL.MAX_ELEMENTS_INDICES]:\n    // Guess: \"Reasonably safe\" per webglstats.com - could be higher/lower (on some mobile devices)\n    (gl) => (gl.getExtension(OES_element_index) ? 16777216 : 65535),\n  [GL.MAX_ELEMENTS_VERTICES]:\n    // Guess: \"Reasonably safe\" per webglstats.com - could be higher/lower (on some mobile devices)\n    (gl) => 16777216,\n  [GL.MAX_FRAGMENT_INPUT_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_FRAGMENT_UNIFORM_BLOCKS]: getWebGL2ValueOrZero,\n  [GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_SAMPLES]: getWebGL2ValueOrZero,\n  [GL.MAX_SERVER_WAIT_TIMEOUT]: getWebGL2ValueOrZero,\n  [GL.MAX_TEXTURE_LOD_BIAS]: getWebGL2ValueOrZero,\n  [GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]: getWebGL2ValueOrZero,\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_UNIFORM_BLOCK_SIZE]: getWebGL2ValueOrZero,\n  [GL.MAX_UNIFORM_BUFFER_BINDINGS]: getWebGL2ValueOrZero,\n  [GL.MAX_VARYING_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_VERTEX_OUTPUT_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MAX_VERTEX_UNIFORM_BLOCKS]: getWebGL2ValueOrZero,\n  [GL.MAX_VERTEX_UNIFORM_COMPONENTS]: getWebGL2ValueOrZero,\n  [GL.MIN_PROGRAM_TEXEL_OFFSET]: getWebGL2ValueOrZero,\n  [GL.MAX_PROGRAM_TEXEL_OFFSET]: getWebGL2ValueOrZero,\n  [GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]: getWebGL2ValueOrZero\n};\n\n// A \"replacement\" gl.getParameter that accepts \"enums\" from extensions and WebGL2\n// and returns reasonably safe defaults\nexport function getParameterPolyfill(gl: WebGLRenderingContext, originalGetParameter, pname) {\n  // Return mock limits (usually 0) for WebGL2 constants to ensure these\n  // can be queries without error\n  const limit = WEBGL_PARAMETERS[pname];\n  const value = typeof limit === 'function' ? limit(gl, originalGetParameter, pname) : limit;\n  const result = value !== undefined ? value : originalGetParameter(pname);\n  return result;\n}\n"],"mappings":"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"}