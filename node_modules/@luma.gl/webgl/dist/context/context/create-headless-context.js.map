{"version":3,"file":"create-headless-context.js","names":["ERR_HEADLESSGL_FAILED","ERR_HEADLESSGL_LOAD","CONTEXT_DEFAULTS","width","height","debug","throwOnError","headlessGL","registerHeadlessGL","headlessgl","isHeadlessGLRegistered","createHeadlessContext","options","webgl1","webgl2","Error","gl"],"sources":["../../../src/context/context/create-headless-context.ts"],"sourcesContent":["// luma.gl, MIT license\n// Copyright (c) vis.gl contributors\n\nconst ERR_HEADLESSGL_FAILED =\n  'Failed to create WebGL context in Node.js, headless gl returned null';\n\nconst ERR_HEADLESSGL_LOAD = '\\\n  luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL \\\n  contexts can not be created. This may not be an error. For example, this is a \\\n  typical configuration for isorender applications running on the server.';\n\nconst CONTEXT_DEFAULTS = {\n  width: 1,\n  height: 1,\n  debug: true,\n  throwOnError: false\n};\n\n/** Duck typing for the main headless gl export, a function to create contexts */\nexport type HeadlessGL = (width: number, height: number, options: Record<string, unknown>) => WebGLRenderingContext;\n\nlet headlessGL: HeadlessGL | null = null; \n\n/** By importing `gl` and registering it with this function, contexts can be created under Node.js */\nexport function registerHeadlessGL(headlessgl: HeadlessGL) {\n  headlessGL = headlessgl;\n}\n\n/** @returns true if headless gl is registered */\nexport function isHeadlessGLRegistered(): boolean {\n  return headlessGL !== null;\n}\n\n/** Create headless gl context (for running under Node.js) */\nexport function createHeadlessContext(options?: Record<string, any>): WebGLRenderingContext {\n  options = {...CONTEXT_DEFAULTS, ...options};\n\n  const {width, height, webgl1, webgl2} = options;\n\n  if (webgl2 && !webgl1) {\n    throw new Error('headless-gl does not support WebGL2');\n  }\n  if (!headlessGL) {\n    throw new Error(ERR_HEADLESSGL_LOAD);\n  }\n  const gl = headlessGL(width, height, options);\n  if (!gl) {\n    throw new Error(ERR_HEADLESSGL_FAILED);\n  }\n  return gl;\n}\n"],"mappings":"AAGA,MAAMA,qBAAqB,GACzB,sEAAsE;AAExE,MAAMC,mBAAmB,GAAG;AAC5B;AACA;AACA,0EAA0E;AAE1E,MAAMC,gBAAgB,GAAG;EACvBC,KAAK,EAAE,CAAC;EACRC,MAAM,EAAE,CAAC;EACTC,KAAK,EAAE,IAAI;EACXC,YAAY,EAAE;AAChB,CAAC;AAKD,IAAIC,UAA6B,GAAG,IAAI;AAGxC,OAAO,SAASC,kBAAkBA,CAACC,UAAsB,EAAE;EACzDF,UAAU,GAAGE,UAAU;AACzB;AAGA,OAAO,SAASC,sBAAsBA,CAAA,EAAY;EAChD,OAAOH,UAAU,KAAK,IAAI;AAC5B;AAGA,OAAO,SAASI,qBAAqBA,CAACC,OAA6B,EAAyB;EAC1FA,OAAO,GAAG;IAAC,GAAGV,gBAAgB;IAAE,GAAGU;EAAO,CAAC;EAE3C,MAAM;IAACT,KAAK;IAAEC,MAAM;IAAES,MAAM;IAAEC;EAAM,CAAC,GAAGF,OAAO;EAE/C,IAAIE,MAAM,IAAI,CAACD,MAAM,EAAE;IACrB,MAAM,IAAIE,KAAK,CAAC,qCAAqC,CAAC;EACxD;EACA,IAAI,CAACR,UAAU,EAAE;IACf,MAAM,IAAIQ,KAAK,CAACd,mBAAmB,CAAC;EACtC;EACA,MAAMe,EAAE,GAAGT,UAAU,CAACJ,KAAK,EAAEC,MAAM,EAAEQ,OAAO,CAAC;EAC7C,IAAI,CAACI,EAAE,EAAE;IACP,MAAM,IAAID,KAAK,CAACf,qBAAqB,CAAC;EACxC;EACA,OAAOgB,EAAE;AACX"}